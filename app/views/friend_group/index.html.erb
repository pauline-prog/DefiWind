<%= render 'components/navbar-top-back' %>

<div class="card">
  <p>Classement gÃ©nÃ©ral entre amis ðŸ’ª</p>
</div>

<div class="classement_friend d-flex justify-content-center">
  <% @events = Event.where(course: true) %>
  <%= form_tag friend_group_index_path, method: :get do %>
    <%= label_tag "CrÃ©er un classement entre amis" %><br>

    <%= select_tag "course", options_from_collection_for_select(@events, "id", "title"), prompt: "Course", class: 'input-classement' %> 

    <%= text_field_tag :event, params[:event], placeholder: "Type in event title", class: 'input-classement' %><br>
    <%= text_field_tag :first_query, params[:first_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= text_field_tag :second_query, params[:second_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= text_field_tag :third_query, params[:third_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= text_field_tag :fourth_query, params[:fourth_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= text_field_tag :fifth_query, params[:fifth_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= text_field_tag :sixth_query, params[:sixth_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= text_field_tag :seventh_query, params[:second_query], placeholder: "Nom, PrÃ©nom ou nÂ° de dossard", class: 'input-classement' %><br>
    <%= submit_tag "Rechercher", class: "btn-classementfr" %>

  <% end %>
</div>

<% if @friend_groups != nil %>
<div class="container">
  <div class="responsive-table-line" style="margin:0px auto;">
  <table class="table-striped justify-content-center">
    <thead class="result thead-light">
      <tr>
        <th scope="col">Course</th>
        <th scope="col">Position</th>
        <th scope="col">Nom</th>
        <th scope="col">PrÃ©nom</th>
        <th scope="col">Temps</th>
        <th scope="col">Points</th>
      </tr>
    </thead>
    <tbody>
    <% @friend_groups.each do |friend_group| %>
      <tr>
      <% users = friend_group.users %>
      <% users.each do |user| %>
        <% positions = user.positions %>
        <% positions = positions.where(event_id: friend_group.event_id) %>
        <% positions.each do |position| %>
            <tr>
              <td><%= friend_group.event.title %></td>
              <td><%= position.place %></td>
              <td class="text-uppercase"><%= user.last_name %></td>
              <td class="text-capitalize"><%= user.first_name %></td>
              <td><%= position.time.hour %>h<%= position.time.min %>min</td>
              <td><%= position.point %></td>
            </tr>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<%= render 'components/navbar-bottom-ranking' %>
